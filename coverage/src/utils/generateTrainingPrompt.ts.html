
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for src/utils/generateTrainingPrompt.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../index.html">All files</a> / <a href="index.html">src/utils</a> generateTrainingPrompt.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/134</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/134</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" ></span></span></span>
import { format } from 'date-fns';
import { es } from 'date-fns/locale';
import { supabase } from "@/integrations/supabase/client";
&nbsp;
<span class="cstat-no" title="statement not covered" >export const generateTrainingPrompt = async (latestActivity: any, effort: number | null | undefined, energy: number, condition: string | null) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const { data: { user } } = await supabase.auth.getUser();</span>
<span class="cstat-no" title="statement not covered" >    if (!user) throw new Error('No user found');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const { data: onboarding } = await supabase</span>
<span class="cstat-no" title="statement not covered" >      .from('user_onboarding')</span>
<span class="cstat-no" title="statement not covered" >      .select('*')</span>
<span class="cstat-no" title="statement not covered" >      .eq('user_id', user.id)</span>
<span class="cstat-no" title="statement not covered" >      .single();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!onboarding) throw new Error('No onboarding data found');</span>
&nbsp;
    // Get user's personal bests
<span class="cstat-no" title="statement not covered" >    const { data: profileData } = await supabase</span>
<span class="cstat-no" title="statement not covered" >      .from('user_pb_profiles')</span>
<span class="cstat-no" title="statement not covered" >      .select('gender, date_of_birth')</span>
<span class="cstat-no" title="statement not covered" >      .eq('user_id', user.id)</span>
<span class="cstat-no" title="statement not covered" >      .maybeSingle();</span>
    
    // Get user's race results for context
<span class="cstat-no" title="statement not covered" >    const { data: raceResults } = await supabase</span>
<span class="cstat-no" title="statement not covered" >      .from('race_results')</span>
<span class="cstat-no" title="statement not covered" >      .select('*')</span>
<span class="cstat-no" title="statement not covered" >      .eq('user_id', user.id)</span>
<span class="cstat-no" title="statement not covered" >      .order('race_date', { ascending: false })</span>
<span class="cstat-no" title="statement not covered" >      .limit(5);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const { data: activities } = await supabase.functions.invoke('fetch-strava-activities', {</span>
<span class="cstat-no" title="statement not covered" >      body: { user_id: user.id }</span>
<span class="cstat-no" title="statement not covered" >    });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    let recentActivitiesText = '';</span>
<span class="cstat-no" title="statement not covered" >    let averageDistanceText = '';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (activities?.activities &amp;&amp; activities.activities.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      const recentActivities = activities.activities.slice(0, 5);</span>
<span class="cstat-no" title="statement not covered" >      recentActivitiesText = recentActivities.map(activity =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        const date = format(new Date(activity.start_date), "d 'de' MMMM", { locale: es });</span>
<span class="cstat-no" title="statement not covered" >        const distance = (activity.distance / 1000).toFixed(2);</span>
        
        // Use elapsed_time instead of moving_time for more accurate training load assessment
<span class="cstat-no" title="statement not covered" >        let durationText = '';</span>
<span class="cstat-no" title="statement not covered" >        if (activity.elapsed_time) {</span>
<span class="cstat-no" title="statement not covered" >          const minutes = Math.floor(activity.elapsed_time / 60);</span>
<span class="cstat-no" title="statement not covered" >          if (minutes &gt;= 60) {</span>
<span class="cstat-no" title="statement not covered" >            const hours = Math.floor(minutes / 60);</span>
<span class="cstat-no" title="statement not covered" >            const remainingMinutes = minutes % 60;</span>
<span class="cstat-no" title="statement not covered" >            durationText = `${hours}h ${remainingMinutes}min`;</span>
<span class="cstat-no" title="statement not covered" >          } else {</span>
<span class="cstat-no" title="statement not covered" >            durationText = `${minutes} minutos`;</span>
<span class="cstat-no" title="statement not covered" >          }</span>
<span class="cstat-no" title="statement not covered" >        }</span>
        
        // Add heart rate data if available
<span class="cstat-no" title="statement not covered" >        let heartRateText = '';</span>
<span class="cstat-no" title="statement not covered" >        if (activity.average_heartrate) {</span>
<span class="cstat-no" title="statement not covered" >          heartRateText = ` con frecuencia cardíaca media de ${Math.round(activity.average_heartrate)} ppm`;</span>
<span class="cstat-no" title="statement not covered" >        }</span>
        
        // Add pace information if available
<span class="cstat-no" title="statement not covered" >        let paceText = '';</span>
<span class="cstat-no" title="statement not covered" >        if (activity.average_speed &amp;&amp; activity.average_speed &gt; 0) {</span>
          // Convert m/s to min/km
<span class="cstat-no" title="statement not covered" >          const paceMinPerKm = 16.6667 / activity.average_speed;</span>
<span class="cstat-no" title="statement not covered" >          const paceMinutes = Math.floor(paceMinPerKm);</span>
<span class="cstat-no" title="statement not covered" >          const paceSeconds = Math.round((paceMinPerKm - paceMinutes) * 60);</span>
<span class="cstat-no" title="statement not covered" >          paceText = ` a ritmo medio de ${paceMinutes}:${paceSeconds.toString().padStart(2, '0')} min/km`;</span>
<span class="cstat-no" title="statement not covered" >        }</span>
        
        // Add detailed lap information if available
<span class="cstat-no" title="statement not covered" >        let lapsText = '';</span>
<span class="cstat-no" title="statement not covered" >        if (activity.laps &amp;&amp; activity.laps.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >          lapsText = '\n    - Desglose por vueltas: ' + activity.laps.map((lap: any, index: number) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            const lapDistance = (lap.distance / 1000).toFixed(2);</span>
<span class="cstat-no" title="statement not covered" >            let lapPace = '';</span>
<span class="cstat-no" title="statement not covered" >            if (lap.average_speed &amp;&amp; lap.average_speed &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >              const lapPaceMinPerKm = 16.6667 / lap.average_speed;</span>
<span class="cstat-no" title="statement not covered" >              const lapPaceMinutes = Math.floor(lapPaceMinPerKm);</span>
<span class="cstat-no" title="statement not covered" >              const lapPaceSeconds = Math.round((lapPaceMinPerKm - lapPaceMinutes) * 60);</span>
<span class="cstat-no" title="statement not covered" >              lapPace = ` a ${lapPaceMinutes}:${lapPaceSeconds.toString().padStart(2, '0')} min/km`;</span>
<span class="cstat-no" title="statement not covered" >            }</span>
<span class="cstat-no" title="statement not covered" >            let lapHR = '';</span>
<span class="cstat-no" title="statement not covered" >            if (lap.average_heartrate) {</span>
<span class="cstat-no" title="statement not covered" >              lapHR = ` con FC ${Math.round(lap.average_heartrate)} ppm`;</span>
<span class="cstat-no" title="statement not covered" >            }</span>
<span class="cstat-no" title="statement not covered" >            return `Vuelta ${index + 1}: ${lapDistance}km${lapPace}${lapHR}`;</span>
<span class="cstat-no" title="statement not covered" >          }).join('; ');</span>
<span class="cstat-no" title="statement not covered" >        }</span>
        
<span class="cstat-no" title="statement not covered" >        return `- ${activity.name}, ${distance}km el ${date}${durationText ? ` en ${durationText}` : ''}${heartRateText}${paceText}${lapsText}`;</span>
<span class="cstat-no" title="statement not covered" >      }).join('\n');</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const conditionText = {</span>
<span class="cstat-no" title="statement not covered" >      'physical_discomfort': 'molestias físicas',</span>
<span class="cstat-no" title="statement not covered" >      'mild_cold': 'algo resfriado',</span>
<span class="cstat-no" title="statement not covered" >      'stressed': 'estrés',</span>
<span class="cstat-no" title="statement not covered" >      'stomach_issues': 'problemas estomacales',</span>
<span class="cstat-no" title="statement not covered" >      'all_good': 'perfectamente'</span>
<span class="cstat-no" title="statement not covered" >    }[condition || 'all_good'];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    let lastActivityText = '';</span>
<span class="cstat-no" title="statement not covered" >    if (latestActivity) {</span>
<span class="cstat-no" title="statement not covered" >      const { data: latestCondition } = await supabase</span>
<span class="cstat-no" title="statement not covered" >        .from('daily_conditions')</span>
<span class="cstat-no" title="statement not covered" >        .select('effort_level')</span>
<span class="cstat-no" title="statement not covered" >        .eq('user_id', user.id)</span>
<span class="cstat-no" title="statement not covered" >        .order('created_at', { ascending: false })</span>
<span class="cstat-no" title="statement not covered" >        .limit(1)</span>
<span class="cstat-no" title="statement not covered" >        .maybeSingle();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      lastActivityText = latestCondition?.effort_level !== null &amp;&amp; latestCondition?.effort_level !== undefined</span>
<span class="cstat-no" title="statement not covered" >        ? `En su último entrenamiento corrió ${(latestActivity.distance / 1000).toFixed(2)}km y su percepción de esfuerzo fue de ${latestCondition.effort_level} sobre 10.`</span>
<span class="cstat-no" title="statement not covered" >        : `En su último entrenamiento corrió ${(latestActivity.distance / 1000).toFixed(2)}km.`;</span>
<span class="cstat-no" title="statement not covered" >    }</span>
    
    // Format user profile information
<span class="cstat-no" title="statement not covered" >    let userProfileText = '';</span>
<span class="cstat-no" title="statement not covered" >    if (profileData) {</span>
<span class="cstat-no" title="statement not covered" >      const parts = [];</span>
<span class="cstat-no" title="statement not covered" >      if (profileData.gender) {</span>
<span class="cstat-no" title="statement not covered" >        parts.push(`${profileData.gender === 'Male' ? 'hombre' : 'mujer'}`);</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >      if (profileData.date_of_birth) {</span>
<span class="cstat-no" title="statement not covered" >        const age = Math.floor((new Date().getTime() - new Date(profileData.date_of_birth).getTime()) / 31536000000);</span>
<span class="cstat-no" title="statement not covered" >        parts.push(`${age} años`);</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >      if (parts.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >        userProfileText = `\n\nEntrenando a un atleta ${parts.join(', ')}.`;</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    }</span>
    
    // Format personal best results
<span class="cstat-no" title="statement not covered" >    let personalBestsText = '';</span>
<span class="cstat-no" title="statement not covered" >    if (raceResults &amp;&amp; raceResults.length &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      personalBestsText = '\n\nMarcas personales:';</span>
<span class="cstat-no" title="statement not covered" >      raceResults.forEach(result =&gt; {</span>
<span class="cstat-no" title="statement not covered" >        const raceDate = format(new Date(result.race_date), "d 'de' MMMM 'de' yyyy", { locale: es });</span>
<span class="cstat-no" title="statement not covered" >        const hours = result.hours ? `${result.hours}h ` : '';</span>
<span class="cstat-no" title="statement not covered" >        const minutes = result.minutes ? `${result.minutes}min ` : '';</span>
<span class="cstat-no" title="statement not covered" >        const seconds = result.seconds ? `${result.seconds}s` : '';</span>
<span class="cstat-no" title="statement not covered" >        personalBestsText += `\n- ${result.distance}: ${hours}${minutes}${seconds}(${raceDate})`;</span>
<span class="cstat-no" title="statement not covered" >      });</span>
<span class="cstat-no" title="statement not covered" >      personalBestsText += '\n\nEstas marcas son históricas y no garantizan el rendimiento actual del atleta.';</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return `Eres un entrenador de atletismo de alto nivel, aunque entrenas a gente de todos los ámbitos y niveles. Estás entrenando a un atleta que lleva corriendo regularmente ${onboarding.running_experience}.${userProfileText}</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >Suele entrenar ${onboarding.weekly_frequency.toLowerCase()} a la semana.${recentActivitiesText ? `\n\nEstos son sus últimos entrenamientos:\n${recentActivitiesText}` : ''}</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >${averageDistanceText ? `${averageDistanceText}\n\n` : ''}Hoy es ${format(new Date(), "d 'de' MMMM 'de' yyyy", { locale: es })}, ${</span>
<span class="cstat-no" title="statement not covered" >      onboarding.goal_type === "Quiero preparar una carrera lo mejor posible" </span>
<span class="cstat-no" title="statement not covered" >        ? `y se está preparando para correr ${onboarding.race_distance || 'una carrera'} el ${format(new Date(onboarding.race_date || ''), "d 'de' MMMM 'de' yyyy", { locale: es })}.` </span>
<span class="cstat-no" title="statement not covered" >        : 'y entrena para mantenerse en forma.'</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >${lastActivityText ? `${lastActivityText} ` : ''}Su percepción de niveles de energía es de ${energy} sobre 4 (siendo 4 lleno de energía y 1 completamente exhausto). Se encuentra con ${conditionText}.${personalBestsText}</span>
&nbsp;
NOTA: Ten en cuenta que los datos de frecuencia cardíaca podrían no ser completamente precisos debido a posibles problemas con los monitores de frecuencia cardíaca.
&nbsp;
Basado en las percepciones personales, objetivos e historial de entrenamientos, sugiere un entrenamiento para el usuario a realizar en el día de hoy. El formato en que lo aportes debe incluir un título de no más de 10 palabras explicando en qué consiste el entrenamiento, una descripción en la cual se explique de forma más detallada cómo se ha de ejecutar el entrenamiento y sensaciones que debe tener mientras lo ejecute (no recomiendes un ritmo específico de entrenamiento, la recomendación debe girar en torno a las percepciones del usuario). La descripción escríbela de forma relativamente concisa (máximo 3 párrafos cortos). Debes también incluir una sesión alternativa a realizar en caso de que no le encaje la recomendada al usuario. Esta recomendación incluirá también un título con el mismo formato que para la sesión principal (empieza en el título indicando "Sesión alternativa:" y luego el nombre de la sesión), pero la descripción será más breve, tan sólo de un párrafo. En caso de que el usuario ya haya entrenado en el día de hoy, no le recomiendes otro entrenamiento en la sesión principal y recomiéndaselo como alternativa, pero avísale sobre los riesgos de doblar entrenamientos en el mismo día (sólo si ya ha entrenado hoy, sino no lo hagas)`;
<span class="cstat-no" title="statement not covered" >  } catch (error) {</span>
<span class="cstat-no" title="statement not covered" >    console.error('Error generating prompt:', error);</span>
<span class="cstat-no" title="statement not covered" >    return '';</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-04-01T11:31:10.378Z
            </div>
        <script src="../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../sorter.js"></script>
        <script src="../../block-navigation.js"></script>
    </body>
</html>
    